<!DOCTYPE html>
<html lang="en" class="govuk-template" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <th:block th:insert="fragments/layout :: head" th:with="pageTitle=|${model.competitionProjectsStatusResource.competitionNumber}: ${model.competitionProjectsStatusResource.competitionName} - Project setup|" />
</head>
<body class="govuk-template__body competition-management project-management">
<th:block th:insert="fragments/layout :: body-start" />
<th:block th:insert="fragments/layout :: global-header" />

<div class="govuk-width-container">
    <th:block th:insert="fragments/layout :: phase-banner" />
    <th:block th:insert="fragments/layout :: header-sub" th:with="linkTitle='Competition dashboard',linkUrl=@{~/management/dashboard/project-setup}" />

    <main class="govuk-main-wrapper" id="main-content" role="main">
        <th:block th:insert="fragments/layout :: page-title" th:with="pageTitle='Project setup',subTitle=|${model.competitionProjectsStatusResource.competitionNumber}: ${model.competitionProjectsStatusResource.competitionName}|,size='govuk-heading-xl'" />

        <form method="GET">
            <div class="search-filters govuk-!-margin-top-6">
                <fieldset class="govuk-fieldset">
                    <legend class="govuk-fieldset__legend govuk-fieldset__legend--m govuk-!-margin-top-0">
                        <h2 class="govuk-fieldset__heading">Filter projects</h2>
                    </legend>
                    <div class="govuk-grid-row">
                        <div class="govuk-grid-column-two-thirds">
                            <label class="govuk-label"
                                   for="applicationSearchString">Search by application number.</label>
                            <input type="number"
                                   class="govuk-input"
                                   id="applicationSearchString"
                                   pattern="[0-9]"
                                   data-prevent-input-regex="[^0-9]"
                                   name="applicationSearchString"
                                   th:value="${model.applicationSearchString}"
                                   value="">
                        </div>
                        <div class="govuk-grid-column-one-third">
                            <button class="govuk-button" >Filter</button>
                        </div>
                    </div>
                </fieldset>
                <div class="govuk-!-margin-top-6">
                    <a href="?" class="govuk-link govuk-body">Clear all filters</a>
                </div>
            </div>
        </form>

        <div class="govuk-tabs">
            <h2 class="govuk-tabs__title">
                Project setup
            </h2>
            <th:block th:insert="project/fragments :: project-dashboard-navigation (selectedTab=${'all'}, competitionId=${model.competitionProjectsStatusResource.competitionNumber}, openQueryCount=${model.openQueryCount}, pendingSpendProfilesCount=${model.pendingSpendProfilesCount}, showAllTabs=${model.showTabs})" />
            <section class="govuk-tabs__panel">
                <th:block th:if="${#lists.isEmpty(model.competitionProjectsStatusResource.projectStatusResources) && param.applicationSearchString == null}">
                    <p class="govuk-body">There are currently no active projects in this competition.</p>
                </th:block>

                <th:block th:unless="${#lists.isEmpty(model.competitionProjectsStatusResource.projectStatusResources)}">
                    <div class="table-overflow">
                        <table id="table-project-status" class="govuk-table icon-table">
                            <thead class="govuk-table__head">
                            <tr class="govuk-table__row">
                                <th class="govuk-table__header" scope="col">Project</th>
                                <th class="govuk-table__header status" scope="col">Project details</th>
                                <th class="govuk-table__header status" scope="col">Project team</th>
                                <th class="govuk-table__header status" scope="col">Documents</th>
                                <th class="govuk-table__header status" scope="col">MO</th>
                                <th class="govuk-table__header status" scope="col">Bank details</th>
                                <th class="govuk-table__header status" scope="col">Finance checks</th>
                                <th class="govuk-table__header status" scope="col">Spend profile</th>
                                <th class="govuk-table__header status" scope="col">GOL</th>
                            </tr>
                            </thead>
                            <tbody class="govuk-table__body cell-border-right">
                            <tr class="govuk-table__row" th:each="project : ${model.competitionProjectsStatusResource.projectStatusResources}">
                                <th class="govuk-table__header" scope="row">
                                    <div class="govuk-grid-row govuk-!-padding-right-0">
                                        <div class="govuk-grid-column-one-half">
                                            <div class="govuk-heading-s govuk-!-margin-0" th:text="${project.projectTitle}" />
                                            <!--/*  origin must one of org.innovateuk.ifs.management.service.CompetitionManagementApplicationServiceImpl.ApplicationOverviewOrigin */-->
                                        </div>
                                        <div class="govuk-grid-column-one-half alignright">
                                            <th:block th:if="${project.projectState.withdrawn}">
                                                <strong class="ifs-project-status-withdrawn">Withdrawn</strong>
                                            </th:block>
                                            <th:block th:if="${project.projectState.handledOffline}">
                                                <strong class="ifs-project-status-managed-offline">Managed offline</strong>
                                            </th:block>
                                            <th:block th:if="${project.projectState.completedOffline}">
                                                <strong class="ifs-project-status-completed-offline">Completed offline</strong>
                                            </th:block>
                                            <th:block th:if="${project.projectState.onHold}">
                                                <strong class="ifs-project-status-on-hold">On hold</strong>
                                            </th:block>
                                        </div>
                                    </div>
                                    <a th:text="${project.applicationNumber}" th:href="${'/management/competition/'+model.competitionProjectsStatusResource.competitionNumber+'/application/'+project.applicationNumber+'?origin=PROJECT_SETUP_MANAGEMENT_STATUS'}" class="govuk-link" />
                                    <small>
                                        <th:block th:text="${project.numberOfPartners > 1 ? project.numberOfPartners+' partners' : project.numberOfPartners+' partner'}" /><br/>
                                        <th:block th:text="${'Lead: '+project.projectLeadOrganisationName}" />
                                        <a th:href="@{/competition/{competitionId}/project/{projectId}/activity-log(competitionId=${model.competitionProjectsStatusResource.competitionNumber},projectId=${project.projectNumber})}"
                                           class="govuk-link">View activity log</a>
                                    </small>
                                </th>
                                <th:block th:insert="project/fragments :: project-status-table(${project.projectDetailsStatus}, 'project-details', ${project.getProjectState().isActive()})" th:with="url=${'/project-setup-management/competition/' + model.competitionProjectsStatusResource.competitionNumber + '/project/' + project.projectNumber + '/details'}" />

                                <th:block th:insert="project/fragments :: project-status-table(${project.projectTeamStatus}, 'project-team', ${project.getProjectState().isActive()})" th:with="url=${'/project-setup-management/competition/' + model.competitionProjectsStatusResource.competitionNumber + '/project/' + project.projectNumber + '/team'}" />

                                <th:block th:if="${model.statusPermissions.get(project.getApplicationNumber()).canAccessDocuments}"
                                          th:insert="project/fragments :: project-status-table(${project.documentsStatus}, 'documents', ${project.getProjectState().isActive()})" th:with="url=${'/project-setup-management/project/'+project.projectNumber+'/document/all'}" />
                                <th:block th:unless="${model.statusPermissions.get(project.getApplicationNumber()).canAccessDocuments}"
                                          th:insert="project/fragments :: project-status-table(${project.documentsStatus}, 'documents', ${project.getProjectState().isActive()})" />

                                <th:block th:if="${model.statusPermissions.get(project.getApplicationNumber()).canAccessMonitoringOfficer}"
                                          th:insert="project/fragments :: project-status-table(${project.monitoringOfficerStatus}, 'MO', ${project.getProjectState().isActive()})" th:with="url=${'/project-setup-management/project/'+ project.projectNumber + '/monitoring-officer'}" />
                                <th:block th:unless="${model.statusPermissions.get(project.getApplicationNumber()).canAccessMonitoringOfficer}"
                                          th:insert="project/fragments :: project-status-table(${project.monitoringOfficerStatus}, 'MO', ${project.getProjectState().isActive()})" />

                                <th:block th:if="${model.statusPermissions.get(project.getApplicationNumber()).canAccessBankDetails}"
                                          th:insert="project/fragments :: project-status-table(${project.bankDetailsStatus}, 'bank-details', ${project.getProjectState().isActive()})" th:with="url=${'/project-setup-management/project/'+ project.projectNumber + '/review-all-bank-details'}" />
                                <th:block th:unless="${model.statusPermissions.get(project.getApplicationNumber()).canAccessBankDetails}"
                                          th:insert="project/fragments :: project-status-table(${project.bankDetailsStatus}, 'bank-details', ${project.getProjectState().isActive()})" />

                                <th:block th:if="${model.statusPermissions.get(project.getApplicationNumber()).canAccessFinanceChecks}"
                                          th:insert="project/fragments :: project-status-table(${project.financeChecksStatus}, 'finance-checks', ${project.getProjectState().isActive()})" th:with="url=${'/project-setup-management/project/'+project.projectNumber+'/finance-check'}" />
                                <th:block th:unless="${model.statusPermissions.get(project.getApplicationNumber()).canAccessFinanceChecks}"
                                          th:insert="project/fragments :: project-status-table(${project.financeChecksStatus}, 'finance-checks', ${project.getProjectState().isActive()})"/>

                                <th:block th:if="${model.statusPermissions.get(project.getApplicationNumber()).canAccessSpendProfile}"
                                          th:insert="project/fragments :: project-status-table(${project.spendProfileStatus}, 'spend-profile', ${project.getProjectState().isActive()})" th:with="url=${'/project-setup-management/project/'+project.projectNumber+'/spend-profile/approval'}" />
                                <th:block th:unless="${model.statusPermissions.get(project.getApplicationNumber()).canAccessSpendProfile}"
                                          th:insert="project/fragments :: project-status-table(${project.spendProfileStatus}, 'spend-profile', ${project.getProjectState().isActive()})" />

                                <th:block th:if="${model.statusPermissions.get(project.getApplicationNumber()).canAccessGrantOfferLetterSend}"
                                          th:insert="project/fragments :: project-status-table(${model.statusPermissions.get(project.getApplicationNumber()).getGrantOfferLetterActivityStatus()},'GOL', ${project.getProjectState().isActive()})"
                                          th:with="url=${'/project-setup-management/project/'+project.projectNumber+'/grant-offer-letter/send'}" />
                                <th:block th:unless="${model.statusPermissions.get(project.getApplicationNumber()).canAccessGrantOfferLetterSend}"
                                          th:insert="project/fragments :: project-status-table(${model.statusPermissions.get(project.getApplicationNumber()).getGrantOfferLetterActivityStatus()},'GOL', ${project.getProjectState().isActive()})" />
                            </tr>
                            </tbody>
                            <tfoot class="govuk-table__foot bank-export">
                            <tr class="govuk-table__row" th:if="${model.canExportBankDetails}">
                                <td class="govuk-table__cell" colspan="5"></td>
                                <td class="govuk-table__cell aligncentre">
                                    <a th:href="@{/competition/{competitionId}/status/bank-details/export(competitionId=${model.competitionProjectsStatusResource.competitionNumber})}" class="govuk-link">Export all bank details</a>
                                </td>
                                <td class="govuk-table__cell" colspan="3"></td>
                            </tr>
                            </tfoot>
                        </table>
                    </div>
                </th:block>
            </section>
        </div>
        <th:block th:insert="fragments/layout :: main-content-end" />
    </main>
</div>
<th:block th:insert="fragments/layout :: footer" />
<th:block th:insert="fragments/layout :: body-end" />
</body>
</html>
