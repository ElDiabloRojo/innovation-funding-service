<!DOCTYPE html>
<html class="no-js" lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <th:block th:insert="fragments/layout :: head" th:with="pageTitle='Finance checks summary'"/>
</head>
<body class="competition-management project-management finance-checks-overview">
<th:block th:insert="fragments/modals :: modal-overlay"/>

<th:block th:insert="fragments/layout :: body-start"/>
<th:block th:insert="fragments/layout :: global-header"/>

<main tabindex="-1" id="content">
    <th:block th:insert="fragments/layout :: header-sub"
              th:with="linkTitle='Projects in setup',linkClass='link-back',linkUrl=@{/competition/{competitionId}/status(competitionId=${model.financeCheckSummaryResource.competitionId})}"/>

    <th:block
        th:with="competitionTitle=${#strings.isEmpty(model.financeCheckSummaryResource.competitionName)} ? |${model.financeCheckSummaryResource.competitionId} : $#{ifs.competition.no_title}| : |${model.financeCheckSummaryResource.competitionId} : ${model.financeCheckSummaryResource.competitionName}|">
        <th:block th:insert="fragments/layout :: page-title"
                  th:with="pageTitle='Finance checks',subTitle=${competitionTitle},size='heading-xlarge'"/>
    </th:block>

    <div th:if="${model.showSpendProfilesGeneratedMessage}" class="success-alert">
        <p><strong
            th:text="|The finance checks have been approved and profiles generated. ${model.financeCheckSummaryResource.spendProfileGeneratedBy}, ${#temporals.format(model.financeCheckSummaryResource.spendProfileGeneratedDate, 'd MMMM yyyy')}|">Generated
            by</strong></p>
    </div>

    <div class="grid-row">
        <div class="column-half">
            <h2 class="heading-medium">Project finances</h2>
            <dl class="standard-definition-list">
                <dt>Total project cost:</dt>
                <dd>&pound;<th:block
                    th:text="${#numbers.formatInteger(model.financeCheckSummaryResource.totalProjectCost,1,'DEFAULT')}"/>
                </dd>
                <dt>Grant applied for:</dt>
                <dd>&pound;<th:block
                    th:text="${#numbers.formatInteger(model.financeCheckSummaryResource.grantAppliedFor,1,'DEFAULT')}"/>
                </dd>
                <dt>Other public sector funding:</dt>
                <dd>&pound;<th:block
                    th:text="${#numbers.formatInteger(model.financeCheckSummaryResource.otherPublicSectorFunding,1,'DEFAULT')}"/>
                </dd>
                <dt>Total percentage grant:</dt>
                <dd th:text="${#numbers.formatInteger(model.financeCheckSummaryResource.totalPercentageGrant,1,'NONE')+'%'}"></dd>
            </dl>
            <a th:href="@{/project/{projectId}/finance-check-overview(projectId=${model.financeCheckSummaryResource.projectId})}">View
                finances</a>
        </div>
        <div class="column-half">
            <h2 class="heading-medium">Project details</h2>
            <dl class="standard-definition-list">
                <dt>Project title:</dt>
                <dd th:text="${model.financeCheckSummaryResource.projectName}"></dd>
                <dt>Start date:</dt>
                <dd th:text="${#temporals.format(model.financeCheckSummaryResource.projectStartDate, 'd MMM yyyy')}"></dd>
                <dt>Duration:</dt>
                <dd th:text="${model.financeCheckSummaryResource.durationInMonths+' months'}"></dd>
            </dl>

            <th:block th:unless="${model.financeCheckSummaryResource.spendProfilesGenerated}">
                <a th:href="@{/competition/{competitionId}/project/{projectId}/duration(competitionId=${model.financeCheckSummaryResource.competitionId},projectId=${model.financeCheckSummaryResource.projectId})}">Edit</a>
            </th:block>
        </div>
    </div>

    <th:block
        th:if="${model.financeCheckSummaryResource.researchParticipationPercentage &gt; model.financeCheckSummaryResource.competitionMaximumResearchPercentage}"
        th:insert="project/financecheck/fragments/finance :: research_participation(researchParticipationPercentage=${model.financeCheckSummaryResource.researchParticipationPercentage},maxResearchPercentage=${model.financeCheckSummaryResource.competitionMaximumResearchPercentage})"/>

    <h2 class="heading-medium">Partner finances</h2>
    <div class="table-overflow extra-margin-bottom">
        <table class="table-progress">
            <thead>
                <tr>
                    <th scope="col">Organisation</th>
                    <th scope="col" class="aligncentre">Viability</th>
                    <th scope="col" class="aligncentre cell-border-right">RAG</th>
                    <th scope="col" class="aligncentre">Eligibility</th>
                    <th scope="col" class="aligncentre cell-border-right">RAG</th>
                    <th scope="col" class="aligncentre">Queries raised</th>
                    <th scope="col" class="aligncentre">Notes</th>
                </tr>
            </thead>
            <tbody>
            <tr th:each="orgDetails, status : ${model.financeCheckSummaryResource.partnerStatusResources}">
                <th scope="row">
                    <th:block th:text="${orgDetails.name}">org name</th:block>
                    <th:block th:if="${orgDetails.isLead()}"> (Lead)</th:block>
                </th>
                <td class="aligncentre">
                    <a th:if="${!orgDetails.viability.notApplicable}"
                       th:href="@{/project/{projectId}/finance-check/organisation/{organisationId}/viability(projectId=${model.financeCheckSummaryResource.projectId},organisationId=${orgDetails.id})}"
                       th:text="${#messages.msg('ifs.project.setup.viability.' + orgDetails.viability)}"
                       th:classappend="${'viability-' + status.index}"/>

                    <span th:if="${orgDetails.viability.notApplicable}"
                          th:text="${#messages.msg('ifs.project.setup.viability.' + orgDetails.viability)}"
                          th:classappend="${'viability-' + status.index}"></span>
                </td>
                <td class="aligncentre cell-border-right">
                <span th:if="${orgDetails.viability.notApplicable}"
                      th:text="${#messages.msg('ifs.project.setup.viability.' + orgDetails.viability)}"
                      th:classappend="${'viability-rag-' + status.index}"></span>
                    <span th:unless="${orgDetails.viability.notApplicable}"
                          th:text="${#messages.msg('ifs.project.setup.rag.' + orgDetails.viabilityRagStatus)}"
                          th:classappend="${'viability-rag-' + status.index}">Green</span>
                </td>
                <td class="aligncentre">
                    <a th:href="@{/project/{projectId}/finance-check/organisation/{organisationId}/eligibility(projectId=${model.financeCheckSummaryResource.projectId},organisationId=${orgDetails.id})}"
                       th:text="${#messages.msg('ifs.project.setup.eligibility.' + orgDetails.eligibility)}"
                       th:classappend="${'eligibility-' + status.index}"/>
                </td>
                <td class="aligncentre cell-border-right">
                <span th:text="${#messages.msg('ifs.project.setup.rag.' + orgDetails.eligibilityRagStatus)}"
                      th:classappend="${'eligibility-rag-' + status.index}">Green</span>
                </td>
                <td class="aligncentre">
                    <a th:href="@{/project/{projectId}/finance-check/organisation/{organisationId}/query(projectId=${model.financeCheckSummaryResource.projectId},organisationId=${orgDetails.id})}"
                       th:text="View"/>
                </td>
                <td class="aligncentre">
                    <a th:href="@{/project/{projectId}/finance-check/organisation/{organisationId}/note(projectId=${model.financeCheckSummaryResource.projectId},organisationId=${orgDetails.id})}">View</a>
                </td>
            </tr>
            </tbody>
        </table>
    </div>

    <form method="POST"
          th:action="@{/project/{projectId}/finance-check/generate(projectId=${model.financeCheckSummaryResource.projectId})}"
          th:if="${model.showEnabledGenerateSpendProfilesButton or model.showDisabledGenerateSpendProfilesButton}">
        <h3 class="heading-medium">Generate spend profile</h3>
        <p>To generate your spend profile, the viability and eligibility sections, plus bank details must be approved
            for all partners. This will create their individual flat spend profiles. These spend profiles can be edited
            during the project.</p>
        <button th:if="${model.showDisabledGenerateSpendProfilesButton}" disabled="disabled"
                class="button generate-spend-profile-main-button">Generate spend profile
        </button>
        <a th:unless="${model.showDisabledGenerateSpendProfilesButton}"
           th:href="@{/project/{projectId}/finance-check/generate/confirm(projectId=${model.financeCheckSummaryResource.projectId})}"
           data-js-modal="generate-spend-profile" class="button generate-spend-profile-main-button">Generate spend
            profile</a>
        <th:block th:unless="${model.showDisabledGenerateSpendProfilesButton}"
                  th:insert="fragments/modals :: generate-spend-profile"/>
    </form>

    <th:block th:insert="fragments/layout :: main-content-end"/>
</main>

<th:block th:insert="fragments/layout :: footer"/>
<th:block th:insert="fragments/layout :: body-end"/>

</body>
</html>
