<!DOCTYPE html>
<html xmlns:th="http://www.w3.org/1999/xhtml">

<th:block th:fragment="costs(form, readOnly, internal, downloadUrl)">

    <fieldset class="govuk-fieldset">
        <legend class="govuk-fieldset__legend govuk-fieldset__legend--m">
            <h2 class="govuk-fieldset__heading">Innovate UK funding</h2>
        </legend>
        <th:block th:unless="${internal}">
            <p class="govuk-body">Innovate UK is the new name for the Technology Strategy Board (TSB).</p>

            <p class="govuk-body">To receive Innovate UK funding, your academic organisation must apply for funding through the Je-S system. To find out more about the Je-S requirements and processes please go to the <a href="https://je-s.rcuk.ac.uk/" class="govuk-link" rel="external">Je-S website</a>.</p>

            <p class="govuk-body">All finances need to be provided before this application can be submitted. If there are any finances outstanding at the competition deadline this
                application will not be submitted into this competition.</p>

            <h3 class="govuk-heading-s">Your project costs</h3>

            <p class="govuk-body">Provide key figures from the Je-S form here to allow your partners to see the overall project costs and contribution required from Innovate
                UK</p>
            <p class="govuk-body">Enter the figures from the following fields on the Je-S form:</p>
        </th:block>

        <div class="govuk-form-group" th:classappend="${#fields.hasErrors('tsbReference')} ? 'govuk-form-group--error'">
            <label class="govuk-label" th:for="tsbReference">
                TSB reference
            </label>
            <span th:unless="${internal}" class="govuk-hint">This number is found at the top of your Je-S form</span>
            <span th:if="${internal}" class="govuk-hint">This number is found at the top of the Je-S form</span>
            <th:block th:insert="question-type/form-elements :: form-validation-custom-messages (errorId=tsbReference)"/>
            <input type="text"
                   class="govuk-input"
                   th:field="*{tsbReference}"
                   required="required"
                   th:readonly="${readOnly}"
                   th:errorclass="govuk-input--error" />
        </div>
    </fieldset>

        <h2 class="govuk-heading-s">Financial resources</h2>
        <p th:unless="${internal}" class="govuk-body">The following costs are entered by the organisation from the summary of resources section
            on your Je-S form</p>
        <p th:if="${internal}" class="govuk-body">The following costs are entered by the organisation from the summary of resources section on the Je-S form</p>

        <div class="govuk-accordion" data-module="accordion" id="accordion-finances">
            <div class="govuk-accordion__section">
                <div class="govuk-accordion__section-header">
                    <h3 class="govuk-accordion__section-heading">
                        <span class="govuk-accordion__section-button">Directly incurred
                        <span class="finance-total" data-mirror="#subtotal-resources"></span></span>
                    </h3>
                </div>
                <div class="govuk-accordion__section-content">
                    <p class="govuk-body govuk-hint">TSB Contribution (please refer to the TSB contribution column)</p>
                    <div class="govuk-form-group"
                         th:classappend="${#fields.hasErrors('incurredStaff')} ? 'govuk-form-group--error'">
                        <label class="govuk-label" th:for="incurredStaff">Staff</label>
                        <th:block
                            th:insert="question-type/form-elements :: form-validation-custom-messages (errorId=incurredStaff)"/>
                        <div>
                            <input type="number"
                                   data-prevent-input-non-number
                                   class="govuk-input"
                                   th:field="*{incurredStaff}"
                                   min="0"
                                   th:attr="data-min-errormessage=#{validation.standard.non.negative.integer.format}"
                                   placeholder="0"
                                   step="1"
                                   th:readonly="${readOnly}"
                                   th:errorclass="govuk-input--error"/>
                        </div>
                    </div>

                    <div class="govuk-form-group"
                         th:classappend="${#fields.hasErrors('incurredTravel')} ? 'govuk-form-group--error'">
                        <label class="govuk-label govuk-!-font-weight-bold" th:for="incurredTravel">Travel &amp; subsistence</label>
                        <th:block
                            th:insert="question-type/form-elements :: form-validation-custom-messages (errorId=incurredTravel)"/>
                        <div>
                            <input class="govuk-input"
                                   th:field="*{incurredTravel}"
                                   type="number"
                                   data-prevent-input-non-number
                                   min="0"
                                   th:attr="data-min-errormessage=#{validation.standard.non.negative.integer.format}"
                                   placeholder="0"
                                   step="1"
                                   th:readonly="${readOnly}"
                                   th:errorclass="govuk-input--error"/>
                        </div>
                    </div>
                    <div class="govuk-form-group"
                         th:classappend="${#fields.hasErrors('incurredOtherCosts')} ? 'govuk-form-group--error'">
                        <label class="govuk-label govuk-!-font-weight-bold" th:for="incurredOtherCosts">Other costs</label>
                        <th:block
                            th:insert="question-type/form-elements :: form-validation-custom-messages (errorId=incurredOtherCosts)"/>

                        <div>
                            <input class="govuk-input"
                                   th:field="*{incurredOtherCosts}"
                                   type="number"
                                   data-prevent-input-non-number
                                   min="0"
                                   th:attr="data-min-errormessage=#{validation.standard.non.negative.integer.format}"
                                   placeholder="0"
                                   step="1"
                                   th:readonly="${readOnly}"
                                   th:errorclass="govuk-input--error"/>
                        </div>
                    </div>
                    <div class="govuk-form-group">
                        <label class="govuk-label" for="subtotal-resources">
                            Total directly incurred costs
                        </label>
                        <div>
                            <input class="govuk-input"
                                   id="subtotal-resources"
                                   data-calculation-fields="#incurredStaff,#incurredTravel,#incurredOtherCosts"
                                   data-calculation-operations="+"
                                   readonly="readonly"
                                   th:value="'Â£' + ${#numbers.formatInteger(form.getTotalIncurred(),0, 'DEFAULT')}"/>
                        </div>
                    </div>
                </div>
            </div>

            <div class="govuk-accordion__section">
                <div class="govuk-accordion__section-header">
                    <h3 class="govuk-accordion__section-heading">
                        <span class="govuk-accordion__section-button">Directly allocated
                            <span class="finance-total" data-mirror="#subtotal-directly-allocated"></span></span>
                    </h3>
                </div>
                <div class="govuk-accordion__section-content">
                    <div class="govuk-form-group"
                         th:classappend="${#fields.hasErrors('allocatedInvestigators')} ? 'govuk-form-group--error'">
                        <label class="govuk-label govuk-!-font-weight-bold" th:for="allocatedInvestigators">Investigators</label>
                        <th:block
                            th:insert="question-type/form-elements :: form-validation-custom-messages (errorId=allocatedInvestigators)"/>
                        <div>
                            <input class="govuk-input"
                                   th:field="*{allocatedInvestigators}"
                                   type="number"
                                   data-prevent-input-non-number
                                   min="0"
                                   th:attr="data-min-errormessage=#{validation.standard.non.negative.integer.format}"
                                   placeholder="0"
                                   step="1"
                                   th:readonly="${readOnly}"
                                   th:errorclass="govuk-input--error"/>
                        </div>
                    </div>
                    <div class="govuk-form-group"
                         th:classappend="${#fields.hasErrors('allocatedEstateCosts')} ? 'govuk-form-group--error'">
                        <label class="govuk-label govuk-!-font-weight-bold" th:for="allocatedEstateCosts">Estates Costs</label>
                        <th:block
                            th:insert="question-type/form-elements :: form-validation-custom-messages (errorId=allocatedEstateCosts)"/>
                        <div>
                            <input class="govuk-input"
                                   th:field="*{allocatedEstateCosts}"
                                   type="number"
                                   data-prevent-input-non-number
                                   min="0"
                                   th:attr="data-min-errormessage=#{validation.standard.non.negative.integer.format}"
                                   placeholder="0"
                                   step="1"
                                   th:readonly="${readOnly}"
                                   th:errorclass="govuk-input--error"/>
                        </div>
                    </div>
                    <div class="govuk-form-group"
                         th:classappend="${#fields.hasErrors('allocatedOtherCosts')} ? 'govuk-form-group--error'">
                        <label class="govuk-label govuk-!-font-weight-bold" th:for="allocatedOtherCosts">Other costs</label>
                        <th:block
                            th:insert="question-type/form-elements :: form-validation-custom-messages (errorId=allocatedOtherCosts)"/>
                        <div>
                            <input class="govuk-input"
                                   th:field="*{allocatedOtherCosts}"
                                   type="number"
                                   data-prevent-input-non-number
                                   min="0"
                                   th:attr="data-min-errormessage=#{validation.standard.non.negative.integer.format}"
                                   placeholder="0"
                                   step="1"
                                   th:readonly="${readOnly}"
                                   th:errorclass="govuk-input--error"/>
                        </div>
                    </div>
                    <div class="govuk-form-group">
                        <label class="govuk-label govuk-!-font-weight-bold" for="subtotal-directly-allocated">
                            Total directly allocated costs
                        </label>
                        <div>
                            <input class="govuk-input"
                                   data-calculation-fields="#allocatedInvestigators,#allocatedEstateCosts,#allocatedOtherCosts"
                                   data-calculation-operations="+"
                                   readonly="readonly" id="subtotal-directly-allocated"
                                   th:value="'Â£' + ${#numbers.formatInteger(form.getTotalAllocated(),0, 'DEFAULT')}"/>
                        </div>
                    </div>
                </div>
            </div>
            <div class="govuk-accordion__section">
                <div class="govuk-accordion__section-header">
                    <h3 class="govuk-accordion__section-heading">
                        <span class="govuk-accordion__section-button">Indirect costs
                            <span class="finance-total" data-mirror="#indirect-costs"></span></span>
                    </h3>
                </div>
                <div class="govuk-accordion__section-content">
                    <div class="govuk-form-group"
                         th:classappend="${#fields.hasErrors('indirectCosts')} ? 'govuk-form-group--error'">
                        <label class="govuk-label govuk-!-font-weight-bold" th:for="indirect-costs">Indirect costs</label>
                        <th:block
                            th:insert="question-type/form-elements :: form-validation-custom-messages (errorId=indirectCosts)"/>
                        <div>
                            <input class="govuk-input"
                                   th:field="*{indirectCosts}"
                                   id="indirect-costs"
                                   type="number"
                                   data-prevent-input-non-number
                                   min="0"
                                   th:attr="data-min-errormessage=#{validation.standard.non.negative.integer.format}"
                                   placeholder="0"
                                   step="1"
                                   th:readonly="${readOnly}"
                                   th:errorclass="govuk-input--error"/>
                        </div>
                    </div>
                    <div class="govuk-form-group">
                        <label class="govuk-label govuk-!-font-weight-bold" for="subtotal-directly-allocated">
                            Total indirect costs
                        </label>
                        <span data-mirror="#indirect-costs"></span>
                    </div>
                </div>
            </div>

            <div class="govuk-accordion__section">
                <div class="govuk-accordion__section-header">
                    <h3 class="govuk-accordion__section-heading">
                        <span class="govuk-accordion__section-button">Exceptions
                            <span class="finance-total" data-mirror="#subtotal-exceptions"></span>
                        </span>
                    </h3>
                </div>
                <div class="govuk-accordion__section-content">
                    <div class="govuk-form-group"
                         th:classappend="${#fields.hasErrors('exceptionsStaff')} ? 'govuk-form-group--error'">
                        <label class="govuk-label govuk-!-font-weight-bold" th:for="exceptionsStaff">Staff</label>
                        <th:block
                            th:insert="question-type/form-elements :: form-validation-custom-messages (errorId=exceptionsStaff)"/>
                        <div>
                            <input class="govuk-input"
                                   th:field="*{exceptionsStaff}"
                                   type="number"
                                   data-prevent-input-non-number
                                   min="0"
                                   th:attr="data-min-errormessage=#{validation.standard.non.negative.integer.format}"
                                   placeholder="0"
                                   step="1"
                                   th:readonly="${readOnly}"
                                   th:errorclass="govuk-input--error"/>
                        </div>
                    </div>
                    <div class="govuk-form-group"
                         th:classappend="${#fields.hasErrors('exceptionsOtherCosts')} ? 'govuk-form-group--error'">
                        <label class="govuk-label govuk-!-font-weight-bold" th:for="exceptionsOtherCosts">Other costs</label>
                        <th:block
                            th:insert="question-type/form-elements :: form-validation-custom-messages (errorId=exceptionsOtherCosts)"/>
                        <div>
                            <input class="govuk-input"
                                   th:field="*{exceptionsOtherCosts}"
                                   type="number"
                                   data-prevent-input-non-number
                                   min="0"
                                   th:attr="data-min-errormessage=#{validation.standard.non.negative.integer.format}"
                                   placeholder="0"
                                   step="1"
                                   th:readonly="${readOnly}"
                                   th:errorclass="govuk-input--error"/>
                        </div>
                    </div>
                    <div class="govuk-form-group">
                        <label class="govuk-label" for="subtotal-exceptions">
                            Total exceptions costs
                        </label>
                        <div>
                            <input id="subtotal-exceptions"
                                   class="govuk-input"
                                   data-calculation-fields="#exceptionsStaff,#exceptionsOtherCosts"
                                   data-calculation-operations="+"
                                   readonly="readonly"
                                   th:value="'Â£' + ${#numbers.formatInteger(form.getTotalExceptions(),0, 'DEFAULT')}"/>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="govuk-form-group totals">
            <label class="govuk-label" for="total">Total project costs</label>
            <div>
                <input class="govuk-input"
                       data-calculation-fields="#subtotal-resources,#indirect-costs,#subtotal-directly-allocated,#subtotal-exceptions"
                       data-calculation-operations="+"
                       id="total"
                       readonly="readonly"
                       th:value="'Â£' + ${#numbers.formatInteger(form.getTotal(),0, 'DEFAULT')}"/>
            </div>
        </div>




    <div class="upload-section">
        <h3 th:unless="${readOnly}" class="govuk-heading-s govuk-!-margin-0">Upload a pdf copy of the Je-S output
            form once you have a status of 'With Council'.</h3>
        <h3 th:if="${readOnly}" class="govuk-heading-s govuk-!-margin-0">Download Je-S form</h3>
        <p th:unless="${readOnly}" class="govuk-body">
            <a target="_blank"
               href="https://www.gov.uk/government/publications/innovate-uk-completing-your-application-project-costs-guidance/guidance-for-academics-applying-via-the-je-s-system">How
                do I create my Je-S output?</a>
        </p>
        <th:block th:insert="question-type/types :: fileupload-fragment(${readOnly && !internal ? 'readonly' : 'edit'},
                                    ${downloadUrl},
                                    ${form.filename},
                                    jesFile,
                                    jesFile,
                                    true,
                                    remove_jes,
                                    upload_jes)"/>
    </div>

</th:block>
</html>
