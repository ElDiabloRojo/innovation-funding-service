<!DOCTYPE html>
<html class="no-js" lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <th:block th:insert="fragments/layout :: head" th:with="pageTitle='Application Dashboard'" />
    <link href="/css/prototype.css" media="screen" rel="stylesheet" type="text/css" />

</head>

<body>

<th:block th:insert="prototypes/fragments/layout :: prototype-nav" />
<th:block th:insert="fragments/layout :: body-start" />
<th:block th:insert="fragments/layout :: global-header" />


<main id="content">

    <th:block th:insert="prototypes/fragments/applicant-view :: prototype-subheader(${'Finance checks'}, ${'/prototypes/1199-project-finances'})" />

	<!-- HARDCODED PROTOTYPE HTML -->

	<th:block th:insert="prototypes/fragments/comp-admin :: prototype-comp-admin-page-title-subheading(${'0102468: Technology inspired'}, ${'Aptrans Ltd'}, ${'Eligibility'})" th:with="partner=lead" />

	<!-- <th:block th:insert="prototypes/fragments/comp-admin :: prototype-comp-navigation" th:with="page='project-setup', status='closed'" /> -->

	<hr class="govuk-section-break govuk-section-break--l govuk-section-break--visible" />

	<th:block th:if="${param.status != null and param.status[0] == 'warning'}">
		<div class="warning-alert">
			<h2 class="govuk-heading-s govuk-!-margin-top-0">The funding amount is now greater than the amount allowable. This is due to increased project costs.</h2>

			<p class="govuk-body">Agree a reduced project cost amount with the applicant.</p>

			<dl class="standard-definition-list">
				<dt class="standard-text-colour">Funding sought:</dt>
				<dd class="standard-text-colour">&pound;67,544</dd>

				<dt>Current funding:</dt>
				<dd>&pound;70,000</dd>
			</dl>
		</div>
	</th:block>


	<th:block th:if="${param.status != null and param.status[0] == 'approved'}">
		<div class="success-alert">
			The partner finance eligibility has been approved by Paul Davidson, 27 July 2016
		</div>
	</th:block>

	<h2 class="govuk-heading-m">Finances overview</h2>

	<div class="table-overflow">
		<table class="govuk-table">
			<thead class="govuk-table__head">
				<tr class="govuk-table__row">
					<th class="govuk-table__header" scope="col">Project duration</th>
					<th class="govuk-table__header" scope="col">Total costs</th>
					<th class="govuk-table__header govuk-table__header--numeric" scope="col">% grant</th>
					<th class="govuk-table__header govuk-table__header--numeric" scope="col">Funding sought</th>
					<th class="govuk-table__header govuk-table__header--numeric" scope="col">Other public sector funding</th>
					<th class="govuk-table__header govuk-table__header--numeric" scope="col">Contribution to project</th>
				</tr>
			</thead>
			<tbody class="govuk-table__body">
				<tr class="govuk-table__row">
					<td class="govuk-table__cell">36 months</td>
					<td class="govuk-table__cell">&pound;286,283</td>
					<td class="govuk-table__cell govuk-table__cell--numeric">55%</td>
					<td class="govuk-table__cell govuk-table__cell--numeric">&pound;180,399</td>
					<td class="govuk-table__cell govuk-table__cell--numeric">20,000</td>
					<td class="govuk-table__cell govuk-table__cell--numeric">&pound;85,885</td>
				</tr>
			</tbody>
		</table>
	</div>

	<th:block th:if="${param.status != null and param.status[0] == 'grantChanged' or param.action != null and param.action[0] == 'grantChanged'}">
		<div class="govuk-body panel">
			<h3 class="govuk-heading-m govuk-!-margin-top-0">% Grant has been reduced from 55% to 40% </h3>
			<dl class="standard-definition-list">
				<dt>Funding sought</dt>
				<dd>&pound;180,399</dd>

				<dt>Funding granted</dt>
				<dd>&pound;160,000</dd>
			</dl>
		</div>
	</th:block>

	<form>

		<th:block th:unless="${param.status != null and param.status[0] == 'approved'}">

			<h3 class="govuk-heading-m">Project finance overview</h3>

			<p class="govuk-body">These finances were initially submitted at the application stage. All saved changes to finances will be viewable by the applicants.</p>

			<p class="govuk-body">All potential changes must be discussed with the lead applicant. You can do this by raising queries through IFS.</p>

			<a href="/prototypes/1581-changes-finances">Review all changes to project finances</a>

		</th:block>


		<th:block th:if="${param.status != null and param.status[0] == 'approved'}">

			<h3 class="govuk-heading-m">Detailed finances</h3>

			<p class="govuk-body">These finances were submitted by the applicant during the application stage. They include all changes made during the eligibility checks.</p>

			<a href="/prototypes/1581-changes-finances">View changes to finances</a>

		</th:block>

		<div class="collapsible section-overview extra-margin">

     	<h2>Labour
        <span class="section-value">&pound; 126,207</span><span class="section-percentage">50%</span>
     	</h2>

			<th:block th:insert="prototypes/fragments/finance-review-questions :: finance-question-labour" />

    	<h2>Overheads
    		<span class="section-value">&pound; 0</span><span class="section-percentage">(40% of labour) 20%</span>
      </h2>

			<th:block th:insert="prototypes/fragments/finance-review-questions :: finance-question-admin-support" />

			<h2>Materials
        <span class="section-value">&pound; 8,600</span><span class="section-percentage">10%</span>
     	</h2>

			<th:block th:insert="prototypes/fragments/finance-review-questions :: finance-question-materials" />

    	<h2>Capital usage
	      <span class="section-value">&pound; 0</span> <span class="section-percentage">0%</span>
       </h2>

			<th:block th:insert="prototypes/fragments/finance-review-questions :: finance-question-capital" />

    	<h2>Subcontracting costs
        <span class="section-value">&pound; 150,000</span> <span class="section-percentage">20%</span>
     	</h2>

			<th:block th:insert="prototypes/fragments/finance-review-questions :: finance-question-subcontracting" />

    	<h2>Travel and subsistence
        <span class="section-value">&pound; 0</span> <span class="section-percentage">0%</span>
     	</h2>

			<th:block th:insert="prototypes/fragments/finance-review-questions :: finance-question-travel" />

    	<h2>Other costs
			  <span class="section-value">&pound; 0</span> <span class="section-percentage">0%</span>
      </h2>

			<th:block th:insert="prototypes/fragments/finance-review-questions :: finance-question-other" />

	    </div>

		<div class="govuk-grid-row total-cost">
	        <div class="govuk-grid-column-one-half">
	            <span class="govuk-heading-m">Total project costs</span>
	        </div>
	        <div class="govuk-grid-column-one-half alignright">
	            <input type="text" readonly="readonly" class="govuk-heading-m width-full alignright" value="Â£ 286,283" />
	        </div>
	    </div>

	    <h3 class="govuk-heading-m">Other funding</h3>

	    <th:block th:insert="prototypes/fragments/finance-review-questions :: finance-question-other-funding" />

		<!-- <div class="extra-margin" th:unless="${param.status != null and param.status[0] == 'approved' or param.status != null and param.status[0] == 'changeGrant'}">
			<a th:href="@{'?status=changeGrant#change-grant'}">Change % grant</a>
		</div>

		<th:block th:if="${param.status != null and param.status[0] == 'changeGrant'}">

			<form>

				<fieldset class="govuk-body panel" id="change-grant">
					<legend class="govuk-visually-hidden">Change % grant</legend>
					<div class="cf">
						<div class="govuk-form-group">
							<label for="change-grant-percent" class="form-label-bold">
								Change % grant
								<span class="govuk-hint">When changing the % grant, the revised funding level must be below the level originally applied for</span>
							</label>
							<input class="form-control width-small" id="change-grant-percent" name="change-grant-percent" type="number" th:value="${(param.action != null and param.action[0] == 'grantUpdated' ? '40' : '55')}" /> <strong><a th:href="@{'?status=changeGrant&#38;action=grantUpdated'}">Update</a></strong>
						</div>
					</div>

					<th:block th:if="${param.action != null and param.action[0] == 'grantUpdated'}">

						<hr class="govuk-section-break govuk-section-break--l govuk-section-break--visible" />

						<dl class="standard-definition-list">
							<dt>Proposed funding</dt>
							<dd>&pound;160,000</dd>
						</dl>

					</th:block>

					<hr class="govuk-section-break govuk-section-break--l govuk-section-break--visible" />

					<div class="govuk-grid-row">
						<div class="govuk-grid-column-one-half">
							<a th:href="${#httpServletRequest.requestURI}">Cancel</a>
						</div>

						<div class="govuk-grid-column-one-half alignright">
							<a href="#" data-js-modal="change-grant" class="govuk-button">Change % grant</a>
						</div>

						<div class="change-grant" role="dialog" aria-hidden="true" style="margin-top: -174px;">
					        <button class="js-close close" aria-label="Close Popup">X</button>
					        <div>

								<h2 class="govuk-heading-m govuk-!-margin-0">Change % grant</h2>

								<p class="govuk-body">This will approve the applicant's project costs.</p>

								<dl class="standard-definition-list">
									<dt>Grant requested</dt>
									<dd>55%</dd>

									<dt>Funding sought</dt>
									<dd>&pound;180,399</dd>

									<dt>Current funding</dt>
									<dd>&pound;160,000</dd>

								</dl>

								<hr class="govuk-section-break govuk-section-break--l govuk-section-break--visible" />

					        	<div class="alignright-button">

									<a href="#" aria-label="Close Popup" class="govuk-button-link js-close">Cancel</a>

									<input type="hidden" id="status" name="status" value="grantChanged" />

					        		<button class="govuk-button" th:formaction="@{${#httpServletRequest.requestURI}}">Change % grant</button>
					        	</div>

					        </div>
					    </div>


					</div>


				</fieldset>

			</form>

		</th:block> -->


	    <div class="extra-margin">
	    	<a href="/prototypes/3807-finance-queries" class="govuk-button button-secondary">Queries</a>
	    	<a href="/prototypes/3990-finance-notes" class="govuk-button button-secondary">Notes</a>
	    </div>


		<th:block th:unless="${param.status != null and param.status[0] == 'approved'}">

		    <h3 class="govuk-heading-m">Approve eligible costs</h3>
		    <p class="govuk-body">After making any necessary changes, eligible costs should be approved.</p>
		    <p class="govuk-body">If changes are made, make sure the applicant has reviewed and understand all changes before you approve.</p>

		    <div class="govuk-form-group">
		    	<label class="block-label selection-button-checkbox" for="costs-reviewed">
			      <input id="costs-reviewed" value="costs-reviewed" type="checkbox" />
			     	These funding costs have been reviewed and are acceptable
			    </label>
		    </div>

		    <div class="govuk-form-group hidden" id="add-rag-rating">
                <label for="rag-rating" class="form-label">Please enter the RAG rating for this eligibility review</label>
                <select id="rag-rating" name="rag-rating" class="govuk-select" >
                	<option value="">--</option>
                	<option value="Green">Green</option>
                	<option value="Amber">Amber</option>
                	<option value="Red">Red</option>
                </select>
            </div>

	    	<button data-js-modal="approve-eligibility-modal" id="approve-eligibility" class="govuk-button" type="submit" disabled="disabled">Approve eligible costs</button>

		    <div class="approve-eligibility-modal" role="dialog" aria-hidden="true" style="margin-top: -174px;">
		        <button class="js-close close" aria-label="Close Popup">X</button>
		        <div>

					<h2 class="govuk-heading-m govuk-!-margin-0">Approve eligible costs</h2>

					<p class="govuk-body">This partner will now be marked as eligible for this project.</p>

					<form>

						<hr class="govuk-section-break govuk-section-break--l govuk-section-break--visible" />

			        	<div class="alignright-button">

							<a href="#" aria-label="Close Popup" class="govuk-button-link js-close">Cancel</a>

							<input type="hidden" id="action" name="action" th:value="${(param.status != null and param.status[0] == 'grantChanged' ? 'grantChanged' : '')}" />
							<input type="hidden" id="status" name="status" value="approved" />

			        		<button class="govuk-button" th:formaction="@{${#httpServletRequest.requestURI}}">Approve eligible costs</button>
			        	</div>

			        </form>

		        </div>
		    </div>

		</th:block>

	</form>

	<hr class="govuk-section-break govuk-section-break--l govuk-section-break--visible" />

	<div class="extra-margin">
		<a href="/prototypes/1199-project-finances" class="govuk-button button-secondary" th:text="${(param.status != null and param.status[0] == 'approved'? 'Return to finance checks' : 'Save and return to finance checks')}">RETURN BUTTON TEXT</a>
	</div>

	<!-- END OFHARDCODED PROTOTYPE HTML -->

    <th:block th:insert="fragments/layout :: main-content-end" />
</main>

<th:block th:insert="fragments/layout :: footer" />
<th:block th:insert="fragments/layout :: body-end" />
<script src="/js/ifs_prototype/jquery.waypoints.min.js" type="text/javascript"></script>
<script src="/js/ifs_prototype/prototype.js" type="text/javascript"></script>
<script type="text/javascript">
	// <![CDATA[
	jQuery('input#admin-support-radio-1').on('click',function(e){
		if ( jQuery(this).is(':checked') ) {
			jQuery("#admin-support-1").show();
			jQuery("#admin-support-2").hide();
			jQuery("#admin-support-3").hide();
			jQuery("#admin-support-4").hide();
		}
	});

	jQuery('input#admin-support-radio-2').on('click',function(e){
		if ( jQuery(this).is(':checked') ) {
			jQuery("#admin-support-1").hide();
			jQuery("#admin-support-2").show();
			jQuery("#admin-support-3").hide();
			jQuery("#admin-support-4").hide();
		}
	});

	jQuery('input#admin-support-radio-3').on('click',function(e){
		if ( jQuery(this).is(':checked') ) {
			jQuery("#admin-support-1").hide();
			jQuery("#admin-support-2").hide();
			jQuery("#admin-support-3").show();
			jQuery("#admin-support-4").hide();
		}
	});

	jQuery('input#admin-support-radio-4').on('click',function(e){
		if ( jQuery(this).is(':checked') ) {
			jQuery("#admin-support-1").hide();
			jQuery("#admin-support-2").hide();
			jQuery("#admin-support-3").hide();
			jQuery("#admin-support-4").show();
		}
	});

	jQuery('select#rag-rating').on('change',function(e){
		var rating = jQuery(this).val();

		if (rating != ''){
			jQuery("#approve-eligibility").removeAttr('disabled');
		}else{
			jQuery("#approve-eligibility").attr('disabled','disabled');
		}
	});


	jQuery('input#costs-reviewed').on('click',function(e){
		if ( jQuery(this).is(':checked') ) {
			jQuery("#add-rag-rating").removeClass('hidden');
		}else{
			jQuery("#add-rag-rating").addClass('hidden');
		}
	});

	// ]]>
</script>
</body>
</html>
