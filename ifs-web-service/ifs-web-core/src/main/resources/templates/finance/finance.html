<!DOCTYPE html>
<html xmlns:th="http://www.w3.org/1999/xhtml">

    <!-- ===========================Form: Your funding =========================== -->
    <th:block th:fragment="finance(model, internalView)" th:with="formInput=${model.formInput}, question=${model.question}">
        <th:block th:unless="${model.readonly}">
            <div class="govuk-form-group">
                <fieldset class="govuk-fieldset">
                    <legend class="govuk-fieldset__legend govuk-fieldset__legend--m">
                        Are you requesting funding?
                    </legend>

                    <th:block th:insert="question-type/form-elements :: form-validation-messages (id='request-funding')" />

                    <div class="govuk-radios">
                        <div class="govuk-radios__item" data-target="request-funding">
                            <input type="radio"
                                   class="govuk-radios__input"
                                   id="request-funding-yes"
                                   name="request-funding"
                                   value="yes"
                                   th:checked="${model.organisationGrantClaimPercentage > 0}"
                                   required="required" />
                            <label for="request-funding-yes" class="govuk-label govuk-radios__label">Yes</label>
                        </div>
                        <th:block th:insert="finance/finance :: requesting_funding" />
                        <div class="govuk-radios__item">
                            <input type="radio"
                                   class="govuk-radios__input"
                                   id="request-funding-no"
                                   name="request-funding"
                                   value="no"
                                   th:checked="${model.organisationGrantClaimPercentage == 0}"
                                   required="required" />
                            <label for="request-funding-no" class="govuk-label govuk-radios__label">No</label>
                        </div>
                    </div>
                </fieldset>
            </div>
        </th:block>
        <th:block th:if="${model.readonly}">
            <dl class="govuk-list readonly-data" th:unles="${model.organisationGrantClaimPercentage == null}">
                <dt th:text="${question.name}">Your Funding level</dt>
                <dd th:text="${model.organisationGrantClaimPercentage+'%'}">50%</dd>
            </dl>
        </th:block>
    </th:block>

    <th:block th:fragment="requesting_funding">
        <div class="govuk-radios__conditional" id="request-funding">
            <div th:class="govuk-form-group" th:classappend="${model.maximumGrantClaimPercentageIsSmallerThanOrganisationGrantClaimPercentage()} ? 'govuk-form-group--error'">
                <label class="govuk-label" th:for="|formInput[cost-${model.organisationGrantClaimPercentageId}-grantClaimPercentage]|">
                    <th:block th:text="${'Select a funding level'}" />
                    <span class="govuk-hint" th:with="isBusiness=${model.currentApplicant.organisation.organisationTypeName=='Business'}">
                        <th:block th:if="${isBusiness}">
                            <th:block th:text="'The maximum you can enter is ' + ${model.maximumGrantClaimPercentage} + '%, based on your organisation size and project research category. The amount you apply for must reflect other funding received and be within the participation levels listed on the' " />
                            <a class="govuk-link" th:href="@{/application/{applicationId}/form/OVERVIEW_FINANCES(applicationId=${model.applicantSection.application.id})}"
                                th:text="${'finances overview'}" />.
                        </th:block>
                        <th:block th:unless="${isBusiness}">
                            The amount you apply for must reflect other funding received and be within the participation
                            levels listed on the
                            <a class="govuk-link" th:href="@{/application/{applicationId}/form/OVERVIEW_FINANCES(applicationId=${model.applicantSection.application.id})}"
                                th:text="${'finances overview'}" />.
                        </th:block>
                    </span>
                </label>

                <th:block th:insert="question-type/form-elements :: form-validation-messages (id=${'cost-' + model.organisationGrantClaimPercentageId + '-grantClaimPercentage'})" />
                <th:block th:insert="question-type/form-elements :: form-validation-messages (id=${'cost-' + model.organisationGrantClaimPercentageId})" />
                <input type="number" min="0" required="required" class="govuk-input govuk-input--width-4 govuk-!-margin-right-1"
                    th:max="${model.maximumGrantClaimPercentage}" th:readonly="${model.readonly}" th:classappend="${model.maximumGrantClaimPercentageIsSmallerThanOrganisationGrantClaimPercentage()} ? 'govuk-input--error'"
                    th:id="|formInput[cost-${model.organisationGrantClaimPercentageId}-grantClaimPercentage]|" th:name="${'finance-grantclaimpercentage-' + question.id + '-' + model.organisationGrantClaimPercentageId}"
                    th:value="${model.organisationGrantClaimPercentage}" placeholder="0" th:attr="data-min-errormessage=#{validation.field.percentage.max.value.or.higher('%min%')},
                                    data-max-errormessage=#{validation.finance.grant.claim.percentage.max('%max%')}" /><span
                    class="govuk-body govuk-!-padding-left-1">&percnt;</span>
            </div>
        </div>
    </th:block>

    <!-- ===========================Form: organisation_size =========================== -->
    <th:block th:fragment="organisation_size(model, internalView)" th:with="formInput=${model.formInput}, question=${model.question}">
        <div class="message-alert govuk-!-margin-bottom-6" th:if="${model.organisationSizeAlert}">
            <h2 class="govuk-heading-s govuk-!-margin-0">Organisation size determines funding</h2>
            <p class="govuk-body">The organisation size is used to calculate your funding level in the application.</p>
            <p class="govuk-body">Changing this selection will reset your funding level.</p>
        </div>

        <th:block th:unless="${model.readonly}">
            <!--/* edit */-->
            <div class="govuk-form-group" th:classappend="${#fields.hasErrors('organisationSize')} ? 'govuk-form-group--error'">
                <fieldset class="govuk-fieldset">
                    <legend class="govuk-fieldset__legend govuk-fieldset__legend--s" id="organisationSize" th:text="${formInput.description}">
                    </legend>
                    <th:block th:insert="question-type/form-elements :: form-hint (hint=${question.description})" />
                    <th:block th:if="${#fields.hasErrors('organisationSize')}">
                        <span class="govuk-error-message" th:each="err : ${#fields.errors('organisationSize')}" th:text="${err}"></span>
                    </th:block>
                    <div class="govuk-radios">
                        <div class="govuk-radios__item"
                             th:each="size : ${T(org.innovateuk.ifs.finance.resource.OrganisationSize).values()}">
                            <input type="radio"
                                   class="govuk-radios__input"
                                   th:id="'financePosition-organisationSize-'+${size.id}"
                                   th:name="'financePosition-organisationSize'"
                                   th:value="${size.id}"
                                   th:checked="${size == model.organisationFinanceSize}"
                                   required="required"
                                   th:attr="data-required-errormessage=#{APPLICATION_ORGANISATION_SIZE_REQUIRED}"/>
                            <label th:for="'financePosition-organisationSize-'+${size.id}"
                                   th:text="${size.description}"
                                   class="govuk-label govuk-radios__label">Label</label>
                        </div>
                    </div>

                </fieldset>
            </div>
        </th:block>
        <th:block th:if="${model.readonly}">
            <!--/* view  */-->
            <dl class="govuk-list readonly-data">
                <dt th:text="${formInput.description}">Size</dt>
                <dd th:unless="${model.organisationFinanceSize == null}"
                    th:text="${model.organisationFinanceSize.description}">Micro or small: claim up to 70%</dd>
            </dl>
        </th:block>
    </th:block>

    <!-- =========================== Form: Organisation Turnover =========================== -->
    <th:block th:fragment="organisation_turnover(model, internalView)" th:with="formInput=${model.formInput}, question=${model.question}">
        <th:block th:unless="${model.readonly}">
            <!--/* edit */-->
            <div class="govuk-form-group" th:classappend="${#fields.hasErrors('formInput[__${formInput.id}__]')} ? 'govuk-form-group--error'">
                <label class="govuk-label--s"
                       th:for="|formInput[${formInput.id}]|"
                       th:id="'form-label-'+${formInput.id}"
                       th:text="${formInput.description}">
                </label>
                <th:block th:insert="question-type/form-elements :: form-hint (hint=${formInput.guidanceTitle})" />
                <th:block th:insert="question-type/form-elements :: form-validation-messages (id=${formInput.id})" />
                <input class="govuk-input govuk-input--width-10"
                       th:classappend="${#fields.hasErrors('formInput[__${formInput.id}__]')} ? 'govuk-input--error'"
                       th:id="|formInput[${formInput.id}]|"
                       th:name="'formInput['+${formInput.id}+']'"
                       th:value="*{formInput[__${formInput.id}__]}"
                       pattern="[0-9]"
                       data-prevent-input-regex="[^0-9]"
                       required="required"
                       min="0"
                       type="number" />
            </div>
        </th:block>
        <th:block th:if="${model.readonly}">
            <!--/* view  */-->
            <dl class="govuk-list readonly-data">
                <dt th:text="${formInput.description}">Turnover (&pound;)</dt>
                <dd>&pound;<th:block th:text="*{formInput[__${formInput.id}__] != null ? #numbers.formatInteger(formInput[__${formInput.id}__],0,'DEFAULT') : '0'}">100,000,000</th:block></dd>
            </dl>
        </th:block>
    </th:block>

    <!-- =========================== Form: Staff Count =========================== -->
    <th:block th:fragment="staff_count(model, internalView)" th:with="formInput=${model.formInput}, question=${model.question}">
        <th:block th:unless="${model.readonly}">
            <!--/* edit */-->
            <div class="govuk-form-group" th:classappend="${#fields.hasErrors('formInput[__${formInput.id}__]')} ? 'govuk-form-group--error'">
                <label class="govuk-label--s"
                       th:for="|formInput[${formInput.id}]|"
                       th:id="'form-label-'+${formInput.id}"
                       th:text="${formInput.description}">
                </label>
                <th:block th:insert="question-type/form-elements :: form-hint (hint=${formInput.guidanceTitle})" />
                <th:block th:insert="question-type/form-elements :: form-validation-messages (id=${formInput.id})" />
                <input class="govuk-input govuk-input--width-10"
                       th:classappend="${#fields.hasErrors('formInput[__${formInput.id}__]')} ? 'govuk-input--error'"
                       type="number"
                       th:id="|formInput[${formInput.id}]|"
                       th:name="'formInput['+${formInput.id}+']'"
                       pattern="[0-9]"
                       data-prevent-input-regex="[^0-9]"
                       min="0"
                       max="2147483647"
                       th:value="*{formInput[__${formInput.id}__]}"
                       required="required" />
            </div>
        </th:block>
        <th:block th:if="${model.readonly}">
            <!--/* view */-->
            <dl class="govuk-list readonly-data">
                <dt th:text="${formInput.description}">Full time employees</dt>
                <dd th:text="*{formInput[__${formInput.id}__]}">440</dd>
            </dl>
        </th:block>
    </th:block>

    <!-- =========================== Form: Financial Year End =========================== -->
    <div th:fragment="financial_year_end(model, internalView)" th:with="formInput=${model.formInput}, question=${model.question}"
         class="govuk-form-group" th:classappend="${#fields.hasErrors('formInput[__${formInput.id}__]')} ? 'govuk-form-group--error'">
        <fieldset th:with="value=(*{formInput[__${formInput.id}__]})" class="govuk-fieldset">
            <legend class="govuk-fieldset__legend govuk-fieldset__legend--s" th:id="|formInput[${formInput.id}]|">
                <h2 class="govuk-fieldset__heading">End of last financial year</h2>
            </legend>
            <th:block th:insert="question-type/form-elements :: form-hint (hint=${formInput.guidanceTitle})" />
            <th:block th:insert="question-type/form-elements :: form-validation-messages (id=${formInput.id})" />
            <div class="date-group" data-past-date="">
                <!--/* this is added for javascript date validation, if we have more mm yyyy fields we might want to do this in a cleaner way */-->
                <div class="day">
                    <input th:id="'year-end-day-'+${formInput.id}" type="hidden" value="1" class="js-visited day" disabled="disabled" />
                </div>
                <div class="month" th:with="month=${#strings.substringBefore(value, '-')}">
                    <label class="govuk-label" th:for="${formInput.id}+'.MMYYYY.month'">
                        Month
                    </label>
                    <input class="govuk-input govuk-input--width-2"
                           th:disabled="${model.readonly}"
                           th:id="${formInput.id}+'.MMYYYY.month'"
                           th:name="'formInput['+${formInput.id}+'].MMYYYY.month'"
                           th:value="${month}"
                           th:classappend="${#fields.hasErrors('formInput[__${formInput.id}__]')} ? 'govuk-input--error'"
                           required="required"
                           placeholder="MM"
                           max="12"
                           min="0"
                           type="number" />
                </div>
                <div class="year" th:with="year=${#strings.substringAfter(value, '-')}">
                    <label class="govuk-label" th:for="${formInput.id}+'.MMYYYY.year'">
                        Year
                    </label>
                    <input class="govuk-input govuk-input--width-4"
                           th:disabled="${model.readonly}"
                           th:id="${formInput.id}+'.MMYYYY.year'"
                           th:name="'formInput['+${formInput.id}+'].MMYYYY.year'"
                           th:value="${year}"
                           th:classappend="${#fields.hasErrors('formInput[__${formInput.id}__]')} ? 'govuk-input--error'"
                           placeholder="YYYY"
                           required="required"
                           min="0"
                           type="number" />
                </div>
                <!--/* The hidden field below is used as a dummy value that is essentially ignored by the LocalDatePropertyEditor in order to allow
                  us to get the LocalDatePropertyEditor to kick in when Spring attempts to bind the current field to the LocalDate value in the
                  backing form. */-->
                <input type="hidden" data-date-month-year th:name="${formInput}" th:id="${formInput.id}" th:value="${formInput}" />
            </div>
        </fieldset>
    </div>

    <!-- =========================== Form: Financial Staff Count =========================== -->
    <div th:fragment="financial_staff_count(model, internalView)" th:with="formInput=${model.formInput}, question=${model.question}"
         class="govuk-form-group" th:classappend="${#fields.hasErrors('formInput[__${formInput.id}__]')} ? 'govuk-form-group--error'">
        <th:block th:unless="${model.readonly}">
            <label class="govuk-label"
                   th:for="|formInput[${formInput.id}]|"
                   th:id="'form-label-'+${formInput.id}"
                   th:text="${formInput.description}">
            </label>
            <th:block th:insert="question-type/form-elements :: form-hint (hint=${formInput.guidanceTitle})" />
            <th:block th:insert="question-type/form-elements :: form-validation-messages (id=${formInput.id})" />
            <input class="govuk-input govuk-input--width-10"
                   th:disabled="${model.readonly or model.complete}"
                   type="number"
                   th:id="|formInput[${formInput.id}]|"
                   th:name="'formInput['+${formInput.id}+']'"
                   th:min="0"
                   th:max="2147483647"
                   th:value="*{formInput[__${formInput.id}__]}"
                   th:required="required"
            />
        </th:block>
        <th:block th:if="${model.readonly}">
            <!--/* view */-->
            <dl class="govuk-list readonly-data">
                <dt th:text="${formInput.description}">Full time employees</dt>
                <dd th:text="*{formInput[__${formInput.id}__]}">440</dd>
            </dl>
        </th:block>
    </div>
</html>
