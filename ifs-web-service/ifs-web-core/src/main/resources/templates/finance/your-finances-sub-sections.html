<!DOCTYPE html>
<html xmlns:th="http://www.w3.org/1999/xhtml">

<!-- ===========================Your finances section view =========================== -->
<th:block th:fragment="finance(model)">
    <div class="your-finances">
        <h2 th:unless="${model.competition.isH2020()}"
            class="govuk-heading-m govuk-!-margin-bottom-0">Finances</h2>
        <div class="message-alert"
             th:unless="${model.competition.collaborationLevel == T(org.innovateuk.ifs.competition.resource.CollaborationLevel).SINGLE}">
            <p class="govuk-body">Only members from your organisation will be able to see a breakdown of your finances.</p>
        </div>
        <p class="govuk-body govuk-!-margin-top-6">Please complete your project finances.</p>
        <ul class="task-list">
            <th:block th:each="childSection : ${model.applicantResource.applicantChildrenSections}">
                <th:block th:if="${model.isSectionDisplayed(childSection)}" th:insert="finance/your-finances-sub-sections :: finance_sub_section_row(${model}, ${childSection})" />
            </th:block>
        </ul>
    </div>

    <th:block th:unless="${model.competition.isFullyFunded()}">
        <h2 class="govuk-heading-m">Finance summary</h2>
        <p class="govuk-body">This is a breakdown of your project costs and sources of funding for this project.</p>

        <th:block th:insert="finance/your-finances-sub-sections :: your_finance_summary (${model})" />

    </th:block>

    <a th:href="${backURL}" class="button-secondary">Return to application overview</a>

</th:block>

<th:block th:fragment="finance_sub_section_row (model, childSection)">
    <li>
        <div class="task">
            <h3 class="govuk-heading-s">
                <th:block th:unless="${model.allReadOnly}">
                    <a th:href="@{/application/{id}/form/section/{sectionId}(id=${model.application.id},sectionId=${childSection.section.id})}"
                        th:text="${childSection.section.name}" class="govuk-link"></a>
                </th:block>
                <th:block th:if="${model.allReadOnly}">
                    <a th:href="@{/application/{id}/form/section/{sectionId}/{applicantOrganisationId}(id=${model.application.id},sectionId=${childSection.section.id},applicantOrganisationId=${model.applicantOrganisationId})}"
                        th:text="${childSection.section.name}" class="govuk-link"></a>
                </th:block>
            </h3>
        </div>
        <div th:if="${model.completedSectionIds.contains(childSection.section.id)}" class="task-status-complete"><span>Complete</span></div>
        <div th:unless="${model.completedSectionIds.contains(childSection.section.id)}" class="task-status-incomplete"><span>Incomplete</span></div>
    </li>
</th:block>

<th:block th:fragment="your_finance_summary (model)">
    <div class="govuk-form-group table-overflow">
        <table class="govuk-table">
            <thead class="govuk-table__head">
                <tr class="govuk-table__row">
                    <th scope="col" class="govuk-table__header govuk-table__header--numeric width-80">Total project costs</th>
                    <th scope="col" class="govuk-table__header govuk-table__header--numeric width-80">Funding level (%)</th>
                    <th scope="col" class="govuk-table__header govuk-table__header--numeric width-80">Funding sought
                        (&pound;)</th>
                    <th scope="col" class="govuk-table__header govuk-table__header--numeric width-80">Other public
                        sector funding (&pound;)</th>
                    <th scope="col" class="govuk-table__header govuk-table__header--numeric width-80">Contribution to
                        project (&pound;)</th>
                </tr>
            </thead>
            <tbody class="govuk-table__body">
                <tr class="govuk-table__row">
                    <td class="govuk-table__cell govuk-table__cell--numeric">
                        <strong>&pound;<th:block th:text="${#numbers.formatInteger(model.organisationFinance != null ? model.organisationFinance.total : 0, 0, 'DEFAULT')}" /></strong>
                    </td>
                    <td class="govuk-table__cell govuk-table__cell--numeric">
                        <th:block th:text="${model.organisationFinance != null ? model.organisationFinance.grantClaimPercentage : 0}+'%'" />
                    </td>
                    <td class="govuk-table__cell govuk-table__cell--numeric">
                        <th:block th:text="${#numbers.formatInteger(model.organisationFinance != null ? model.organisationFinance.totalFundingSought : 0, 0, 'DEFAULT')}" />
                    </td>
                    <td class="govuk-table__cell govuk-table__cell--numeric">
                        <th:block th:text="${#numbers.formatInteger(model.organisationFinance != null ? model.organisationFinance.totalOtherFunding : 0, 0, 'DEFAULT')}" />
                    </td>
                    <td class="govuk-table__cell govuk-table__cell--numeric">
                        <th:block th:text="${#numbers.formatInteger(model.organisationFinance != null ? model.organisationFinance.totalContribution : 0, 0, 'DEFAULT')}" />
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
</th:block>

</html>
