<!DOCTYPE html>
<html lang="en" class="govuk-template" xmlns:th="http://www.w3.org/1999/xhtml">

<th:block th:fragment="status-table(model)">
    <th:block th:if="${#lists.isEmpty(model.competitionProjectsStatusResource.projectStatusResources) && param.applicationSearchString == null}">
        <p class="govuk-body" th:text="${model.emptyTableText}"></p>
    </th:block>

    <th:block th:unless="${#lists.isEmpty(model.competitionProjectsStatusResource.projectStatusResources)}">
        <div class="table-overflow">
            <table id="table-project-status" class="govuk-table icon-table">
                <thead class="govuk-table__head">
                <tr class="govuk-table__row">
                    <th class="govuk-table__header" scope="col">Project</th>
                    <th:block th:each="column : ${model.columns}">
                        <th class="govuk-table__header status" scope="col" th:text="${column.name}">column name</th>
                    </th:block>
                </tr>
                </thead>
                <tbody class="govuk-table__body cell-border-right">
                <tr class="govuk-table__row" th:each="row : ${model.rows}">
                    <th class="govuk-table__header" scope="row">
                        <div class="govuk-grid-row govuk-!-padding-right-0">
                            <div class="govuk-grid-column-one-half">
                                <div class="govuk-heading-s govuk-!-margin-0" th:text="${row.projectName}" />
                            </div>
                            <div class="govuk-grid-column-one-half alignright">
                                <th:block th:if="${row.projectState.withdrawn}">
                                    <strong class="ifs-project-status-withdrawn">Withdrawn</strong>
                                </th:block>
                                <th:block th:if="${row.projectState.handledOffline}">
                                    <strong class="ifs-project-status-managed-offline">Managed offline</strong>
                                </th:block>
                                <th:block th:if="${row.projectState.completedOffline}">
                                    <strong class="ifs-project-status-completed-offline">Completed offline</strong>
                                </th:block>
                                <th:block th:if="${row.projectState.onHold}">
                                    <strong class="ifs-project-status-on-hold">On hold</strong>
                                </th:block>
                            </div>
                        </div>
                        <a th:text="${row.applicationNumber}" th:href="${'/management/competition/'+row.competitionId+'/application/'+row.applicationNumber+'?origin=PROJECT_SETUP_MANAGEMENT_STATUS'}" class="govuk-link"/>
                        <small>
                            <th:block th:text="${row.numberOfPartners > 1 ? row.numberOfPartners+' partners' : row.numberOfPartners+' partner'}" /><br/>
                            <th:block th:text="${'Lead: '+row.projectLeadOrganisationName}" />
                            <a th:href="@{/competition/{competitionId}/project/{projectId}/activity-log(competitionId=${row.competitionId},projectId=${row.projectId})}"
                            class="govuk-link">View activity log</a>
                        </small>
                    </th>

                    <th:block th:each="state : ${row.states}">
                        <th:block th:insert="fragments/status :: project-status-table(${state.getValue().toString()}, ${state.getKey()}, ${row.getProjectState().isActive()})" th:with="url=${'/project-setup-management/competition/' + row.competitionId + '/project/' + row.projectId + '/details'}" />
                    </th:block>
                </tr>
                </tbody>
            </table>
        </div>
    </th:block>
</th:block>

<th:block th:fragment="project-status-table(status, columnType, isActive)">
    <th:block th:switch="${status}">
        <td th:case="'VIEW'" class="govuk-table__cell status">
            <th:block th:if="${url}">
                <a th:href="${url}" class="govuk-link">View</a>
            </th:block>
        </td>
        <td th:case="'COMPLETE'" class="govuk-table__cell status ok">
            <th:block th:if="${url}">
                <a th:href="${url}" class="govuk-link">
                    <th:block th:text="${columnType == 'MO' ? 'Assigned' : 'Complete'}">Assigned</th:block>
                </a>
            </th:block>
            <th:block th:unless="${url}">
                <th:block th:text="${columnType == 'MO' ? 'Assigned' : 'Complete'}">Assigned</th:block>
            </th:block>
        </td>
        <td th:case="'ACTION_REQUIRED'" class="govuk-table__cell status action">
            <th:block th:if="${url}">
                <a th:href="${url}" class="govuk-link">
                    <th:block th:if="${columnType == 'MO'}">Assign</th:block>
                    <th:block th:unless="${columnType == 'MO'}">Review</th:block>
                </a>
            </th:block>
            <th:block th:unless="${url}">
                <th:block th:if="${columnType == 'MO'}">Assign</th:block>
                <th:block th:unless="${columnType == 'MO'}">Review</th:block>
            </th:block>
        </td>
        <td th:case="'NOT_STARTED'" class="govuk-table__cell status">
            <span class="govuk-visually-hidden">Stage is not yet available</span>
        </td>
        <td th:case="'NOT_REQUIRED'" class="govuk-table__cell status na">
            <span class="govuk-visually-hidden">Not required for this partner</span>
        </td>
        <td th:case="'PENDING'" class="govuk-table__cell status waiting">
            <th:block th:if="${url}">
                <a th:href="${url}" class="govuk-link">
                    <span th:text="${columnType == 'project-details' or columnType == 'project-team' or not isActive ? 'Incomplete' : 'Pending'}">Incomplete</span>
                </a>
            </th:block>
            <th:block th:unless="${url}">
                <span th:text="${columnType == 'project-details' or columnType == 'project-team' or not isActive ? 'Incomplete' : 'Pending'}">Incomplete</span>
            </th:block>
        </td>
        <td th:case="'REJECTED'" class="govuk-table__cell status rejected">
            <th:block th:if="${url}">
                <a th:href="${url}" class="govuk-link">Rejected</a>
            </th:block>
            <th:block th:unless="${url}">Rejected</th:block>
        </td>
        <td th:case="*" class="govuk-table__cell"></td><!--/* just in case there is a different status we put out an empty td to not break the table */-->
    </th:block>
</th:block>
