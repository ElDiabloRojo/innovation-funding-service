<!DOCTYPE html>
<html xmlns:th="http://www.w3.org/1999/xhtml" xmlns:ifs="http://www.w3.org/1999/xhtml">

<th:block th:fragment="research_category(model)">
    <form
        th:action="@{/application/{applicationId}/form/question/{questionId}/research-category(applicationId=${model.applicationId},questionId=${model.questionId})}"
          method="post"
          th:object="${form}"
          novalidate="novalidate">

        <div class="question">
            <div class="form-group" th:classappend="${#fields.hasErrors('researchCategory')} ? 'form-group-error'">
                <div class="message-alert extra-margin-bottom" th:if="${model.hasApplicationFinances and !model.complete}">
                    <h2 class="heading-small no-margin">What type of research are you undertaking in this project?</h2>
                    <p>The type of research affects the level of funding a business can receive under UK state aid rules.
                        Changing the research category will reset the funding level for all business participants.
                    </p>
                </div>

                <th:block th:if="${model.allReadOnly}">
                    <div class="assign-container assigned-alert"
                         th:unless="${model.userLeadApplicant || model.complete}">
                        <span class="assignee" th:text="|This question is assigned to ${model.leadApplicantName}.|">
                            This question is assigned to Steve Smith.
                        </span>
                    </div>
                    <div th:if="${model.complete}" class="success-alert assignee extra-margin-bottom">
                        <p>Research category is marked as complete</p>
                    </div>
                    <h2 class="heading-medium">Selected research category</h2>
                    <p th:text="${model.researchCategory} ?: 'This field has not been completed.'"
                       th:classappend="${#strings.isEmpty(model.researchCategory)}? 'form-hint'">Experimental development</p>
                </th:block>
                <th:block th:if="${!model.allReadOnly}">
                    <fieldset>
                        <legend class="extra-margin-bottom" id="researchCategory">
                            <h2 class="heading-medium">Select your research category</h2>

                            <span class="form-hint">More <a
                                href="https://www.gov.uk/guidance/innovate-uk-funding-general-guidance-for-applicants#categories-of-research-and-development"
                                target="_blank">guidance on research categories</a></span>

                            <th:block th:if="${#fields.hasErrors('researchCategory')}">
                                <span class="error-message" th:each="err : ${#fields.errors('researchCategory')}"
                                      th:text="${err}"></span>
                            </th:block>
                        </legend>
                        <th:block th:each="item : ${model.availableResearchCategories}">
                            <div class="multiple-choice">
                                <input type="radio"
                                       th:field="*{researchCategory}"
                                       required="required"
                                       th:value="${item.id}"
                                       th:attr="data-required-errormessage=#{validation.field.must.not.be.blank}"/>
                                <label th:for="${#ids.prev('researchCategory')}">
                                    [[${item.name}]]
                                    <span class="form-hint" th:text="${item.description}">description</span>
                                </label>
                            </div>
                        </th:block>
                    </fieldset>
                </th:block>
            </div>

            <div class="extra-margin" th:unless="${model.useNewApplicantMenu}">
                <button class="button" name="save-research-category">Save</button>
                <a class="button button-clear"
                   th:href="@{/application/{applicationId}/form/question/{questionId}(applicationId=${model.applicationId},questionId=${model.questionId})}">Cancel
                </a>
            </div>

            <div class="extra-margin" th:if="${model.useNewApplicantMenu and model.canMarkAsComplete}">
                <!--/* 'Mark as complete' / 'Edit' links */-->
                <th:block th:insert="question-type/form-elements :: form-mark-as-complete-buttons (model=${model})"/>
            </div>

            <input type="hidden" id="cacheTest" value=""/>
        </div>

        <th:block th:if="${model.useNewApplicantMenu}">
            <a th:href="${backURL}" class="button-secondary" th:if="${model.allReadOnly}"
               th:text="${'Return to ' + #strings.toLowerCase(backTitle)}">Return to application overview</a>
            <button th:unless="${model.allReadOnly}"
                    id="application-question-save"
                    type="submit"
                    class="button app-submit-btn"
                    name="save-research-category">Save and return to application overview
            </button>
        </th:block>
    </form>
</th:block>

<th:block th:fragment="research_category_summary(model)">

    <div class="question">
        <dl class="font-xsmall">
            <dt>Selected research category</dt>
            <dd th:text="${model.researchCategory} ?: 'This field has not been completed.'"
                th:classappend="${#strings.isEmpty(model.researchCategory)}? 'form-hint'">Experimental development
            </dd>
        </dl>
        <div class="extra-margin">
            <!--/* 'Mark as complete' / 'Edit' links */-->
            <th:block th:insert="question-type/form-elements :: form-mark-as-complete-buttons (model=${model})"/>
            <!--/* 'Return and edit' link */-->
            <th:block th:if="${model.canMarkAsComplete}"
                th:insert="question-type/form-elements :: form-edit-question-button (model=${model},question=${question})"/>
        </div>
    </div>
</th:block>
</html>
