group 'innovateuk'
version project.version

apply plugin: 'idea'

buildscript {
    repositories { jcenter() }
}

String spCertsVolume = 'ifs-sp-service/src/main/docker/certs'
String idpCertsVolume = 'ifs-idp-service/src/main/docker/certs'
String ldapCertsVolume = 'ifs-ldap-service/src/main/docker/certs'

String spProxyCertificateFileName = 'sp_proxy_certificate.pem'
String idpSigningCertificateFileName = 'idp-signing.crt'
String idpEncryptionCertificateFileName = 'idp-encryption.crt'
String ldapEncryptionCertificateFileName = 'ldap-encryption.crt'

task prepareSecrets {
    // on top of their respective certificates SP and IDP need each other's
    // and the IDP needs ldap's
    copy {
        // Copy from the spCertsVolume and ldapCertsVolume as these files should always present at this point where as
        // the relevant buildDir may well not contain them if a clean has been performed.
        // Additionally it allows us to drop know cert files into the spCertsVolume and ldapCertsVolume for named builds
        from file(spCertsVolume + "/" + spProxyCertificateFileName)
        from file(ldapCertsVolume + "/" + ldapEncryptionCertificateFileName)
        into idpCertsVolume
    }
    copy {
        // Copy from the idpCertsVolume as these files should always present at this point whereas the relevant
        // buildDir may well not contain them if a clean has been performed.
        // Additionally it allows us to drop know cert files into the idpCertsVolume for named builds
        from file(idpCertsVolume + "/" + idpSigningCertificateFileName)
        from file(idpCertsVolume + "/" + idpEncryptionCertificateFileName)
        into spCertsVolume
    }
}
